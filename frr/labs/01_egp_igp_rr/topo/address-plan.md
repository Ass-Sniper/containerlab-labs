
# Address Plan – 01_egp_igp_rr

本文件定义 **01_egp_igp_rr** 实验中使用的所有地址规划，作为：

- 配置编写的唯一事实来源（single source of truth）
- 抓包与控制面验证的对照依据
- 后续实验（EVPN / 多 RR / 多 AFI）的基础模板

---

## 一、地址规划原则

### 1. Loopback 地址

- 每台路由器 **必须** 拥有唯一 Loopback
- 用途：
  - iBGP / RR 建立
  - Router-ID
  - 稳定控制面标识
- 规划规则：

```

rX → X.X.X.X/32

```

---

### 2. 点到点链路地址

- 所有链路使用 `/30`
- 便于：
  - 抓包定位
  - 控制面路径可视化
- 地址命名遵循：

```

10.0.<A><B>.0/30   （A、B 为节点编号）
172.16.<A><B>.0/30 （用于 AS 间 / eBGP）

```

---

### 3. AS 规划

| AS  | 说明                  |
|----:|-----------------------|
| 65001 | 内部 AS（iBGP + RR） |
| 65002 | 外部 AS（eBGP）      |

---

## 二、Loopback 地址分配

| Node | Loopback IP |
|-----:|-------------|
| r1   | 1.1.1.1/32 |
| r2   | 2.2.2.2/32 |
| r3   | 3.3.3.3/32 |
| r4   | 4.4.4.4/32 |
| r5   | 5.5.5.5/32 |
| r6   | 6.6.6.6/32 |

---

## 三、链路地址分配

### r1 ↔ r3（iBGP Client）

| Node | Interface | IP Address      |
|-----:|-----------|-----------------|
| r1   | eth1      | 10.0.13.1/30    |
| r3   | eth1      | 10.0.13.2/30    |

---

### r2 ↔ r3（iBGP Client）

| Node | Interface | IP Address      |
|-----:|-----------|-----------------|
| r2   | eth1      | 10.0.23.1/30    |
| r3   | eth2      | 10.0.23.2/30    |

---

### r3 ↔ r4（AS65001 ↔ AS65002，eBGP）

| Node | Interface | IP Address        |
|-----:|-----------|-------------------|
| r3   | eth3      | 172.16.34.1/30    |
| r4   | eth3      | 172.16.34.2/30    |

---

### r4 ↔ r5（AS65002 内部）

| Node | Interface | IP Address      |
|-----:|-----------|-----------------|
| r4   | eth1      | 10.0.45.1/30    |
| r5   | eth1      | 10.0.45.2/30    |

---

### r4 ↔ r6（AS65002 内部）

| Node | Interface | IP Address      |
|-----:|-----------|-----------------|
| r4   | eth2      | 10.0.46.1/30    |
| r6   | eth1      | 10.0.46.2/30    |

---

## 四、控制面协议使用说明

### OSPF（AS65001）

- 运行节点：`r1 / r2 / r3`
- Area：`0`
- 宣告：
  - Loopback
  - 点到点链路

---

### iBGP（AS65001）

- RR：`r3`
- RR Clients：`r1 / r2`
- 建立方式：
  - `update-source lo`
  - 基于 Loopback 地址

---

### eBGP（AS65002 ↔ AS65001）

- 会话：
  - `r3 (65001)` ↔ `r4 (65002)`
- 使用接口地址：
  - `172.16.34.1 ↔ 172.16.34.2`

---

## 五、地址规划与抓包验证的关系

- BGP 抓包可直接匹配：
  - `1.1.1.1 ↔ 3.3.3.3`（iBGP）
  - `172.16.34.1 ↔ 172.16.34.2`（eBGP）
- Loopback 地址用于：
  - RR 行为确认
  - 报文来源/去向快速识别

---

## 六、后续实验扩展预留

本地址规划为以下实验预留空间：

- iBGP + EVPN（AFI/SAFI 扩展）
- 多 RR / 分层 RR
- 多 VRF
- Overlay（VXLAN）

---

## 七、文件角色说明

| 文件名          | 作用                         |
|-----------------|------------------------------|
| address-plan.md | 地址与拓扑事实来源           |
| topo.yml        | 实例化连接关系               |
| frr.conf        | 协议行为实现                 |
| verification.md | 报文级真实性验证             |
